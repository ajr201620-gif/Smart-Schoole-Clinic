<!doctype html>
<html lang="ar" dir="rtl" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Clinic OS โ Kiosk Call</title>
  <link rel="stylesheet" href="ar.css" />
</head>
<body>
<header class="topbar">
  <div class="brand">
    <div class="logo">๐</div>
    <div>
      <b>ุงููุดู โ ุงุชุตุงู ุงูุทุจูุจ</b>
      <small>WebRTC (ูุฌุงูู ุจุฏูู ุณูุฑูุฑ: ููุณ ุงูุฌูุงุฒ/ุชุจููุจูู)</small>
    </div>
  </div>
  <div class="actions">
    <a class="btn ghost" href="kiosk.html">๐ฉบ ุฑุฌูุน ูููุดู</a>
    <a class="btn ghost" href="doctor.html">๐จโโ๏ธ ููุญุฉ ุงูุทุจูุจ</a>
    <button class="btn ghost" id="btnClear">๐งน ุชุตููุฑ ุงูุบุฑูุฉ</button>
  </div>
</header>

<div class="wrap">
  <div class="panel">
    <div class="h">
      <h2>Room</h2>
      <div class="muted" id="st">Idle</div>
    </div>

    <div class="row">
      <span class="badge">Room ID: <b id="roomTxt">โ</b></span>
      <a class="btn" id="openDoctor" href="call-doctor.html" target="_blank">๐จโโ๏ธ ุงูุชุญ ููุทุจูุจ (ุชุจููุจ ุฌุฏูุฏ)</a>
      <button class="btn" id="btnStart">ุงุจุฏุฃ ุงูุงุชุตุงู</button>
    </div>

    <div class="sep"></div>

    <div class="grid" style="grid-template-columns:1fr 1fr;">
      <div class="panel">
        <div class="h"><h2>ุงููุดู (ุฃูุช)</h2><div class="muted">Local</div></div>
        <video id="vLocal" autoplay playsinline muted style="width:100%; border-radius:18px; border:1px solid var(--stroke);"></video>
      </div>
      <div class="panel">
        <div class="h"><h2>ุงูุทุจูุจ</h2><div class="muted">Remote</div></div>
        <video id="vRemote" autoplay playsinline style="width:100%; border-radius:18px; border:1px solid var(--stroke);"></video>
      </div>
    </div>

    <div class="sep"></div>
    <div class="small">
      โ ุทุฑููุฉ ุงูุชุดุบูู ุงููุฌุงููุฉ: ุงูุชุญ ูุฐู ุงูุตูุญุฉ ุซู ุงุถุบุท โุงูุชุญ ููุทุจูุจโ ูู ุชุจููุจ ุฌุฏูุฏ ุนูู **ููุณ ุงูุฌูุงุฒ**.  
      ุจุนุฏูุง ุงุถุบุท โุงุจุฏุฃ ุงูุงุชุตุงูโ ููุงโูุณูุชุตู ุชููุงุฆููุง.
    </div>
  </div>
</div>

<script src="webrtc-local.js"></script>
<script>
(function(){
  const $ = (s)=>document.querySelector(s);
  const params = new URLSearchParams(location.search);
  const room = params.get("room") || ("R" + Math.random().toString(36).slice(2,8).toUpperCase());
  $("#roomTxt").textContent = room;

  // pass room to doctor link
  $("#openDoctor").href = `call-doctor.html?room=${encodeURIComponent(room)}`;

  $("#btnClear").addEventListener("click", ()=>{
    window.SCWEBRTC.clearRoom(room);
    $("#st").textContent = "Room cleared";
  });

  $("#btnStart").addEventListener("click", async ()=>{
    $("#st").textContent = "Startingโฆ";
    try{
      await window.SCWEBRTC.initKiosk(room, {
        localVideo: $("#vLocal"),
        remoteVideo: $("#vRemote"),
        status: $("#st")
      });
    }catch(e){
      console.error(e);
      alert("ูุดู ุงูุงุชุตุงู. ุชุฃูุฏ ูู ุงูุณูุงุญ ุจุงููุงููุฑุง/ุงููุงูู ููุชุญ ุชุจููุจ ุงูุทุจูุจ.");
    }
  });
})();
</script>
</body>
</html>
