<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Smart School Clinic OS โ Portal</title>
  <meta name="theme-color" content="#0b1020"/>

  <link rel="stylesheet" href="app.css">

<script src="bus.js"></script>
<script src="auth.js"></script>
<script src="triage-ai.js"></script>
<script src="sensor-sim.js"></script>
<script src="visit-session.js"></script>
<script src="doctor-copilot.js"></script>
<script src="protocols.js"></script>
<script src="audit-log.js"></script>
<script src="admin-heatmap.js"></script>
<script src="admin-slips.js"></script>
<script src="parent-summary.js"></script>
<script src="actions.js"></script>
<script src="app-init.js"></script>
</head>

<body>
  <!-- Top Bar -->
  <header class="topbar">
    <div class="brand">
      <div class="logo">SC</div>
      <div class="brandText">
        <div class="name">Smart School Clinic OS</div>
        <div class="tagline">ุจูุงุจุฉ ุงูุฃุฏูุงุฑ โข ูุฑุฒ ุฐูู โข ุฒูุงุฑุฉ ุงูุชุฑุงุถูุฉ โข ุชูุงุฑูุฑ</div>
      </div>
    </div>

    <div class="topActions">
      <span class="pill" id="envPill">Static โข GitHub Pages</span>
      <button class="btn ghost" id="btnReset">๐งน ุชุตููุฑ ุจูุงูุงุช ุงูุฏููู</button>
    </div>
  </header>

  <!-- Hero -->
  <main class="container">
    <section class="hero">
      <div class="heroText">
        <h1>ุงุฎุชุฑ ุจูุงุจุชู</h1>
        <p class="muted">
          ูุธุงู ุนูุงุฏุฉ ูุฏุฑุณูุฉ ุฐููุฉ (ูุณุฎุฉ ุนุฑุถ) โ ุจุฏูู ุณูุฑูุฑุ ูู ุงูุจูุงูุงุช ูุญููุธุฉ ูุญูููุง.
          ุงุฎุชุฑ ุงูุฏูุฑ ูุณูุชู ูุชุญ ุงููุงุฌูุฉ ุงูููุงุณุจุฉ ูุน ุตูุงุญูุงุชูุง.
        </p>

        <div class="heroBadges">
          <span class="chip">AI Triage</span>
          <span class="chip">Sensors Simulator</span>
          <span class="chip">Virtual Visit</span>
          <span class="chip">Consent & Slips</span>
          <span class="chip">Admin Dashboard</span>
        </div>

        <div class="quickRow">
          <button class="btn" id="btnSeed">โก ุชุฌููุฒ ุจูุงูุงุช ุนุฑุถ ุฌุงูุฒุฉ</button>
          <button class="btn ghost" id="btnGoLast">โฉ๏ธ ุงูุฑุฌูุน ูุขุฎุฑ ุฏูุฑ</button>
        </div>
      </div>

      <div class="heroCard">
        <div class="cardTitle">ุญุงูุฉ ุงููุธุงู</div>
        <div class="kpiGrid">
          <div class="kpi">
            <div class="k">Requests</div>
            <div class="v" id="kRequests">โ</div>
          </div>
          <div class="kpi">
            <div class="k">Cases</div>
            <div class="v" id="kCases">โ</div>
          </div>
          <div class="kpi">
            <div class="k">Slips</div>
            <div class="v" id="kSlips">โ</div>
          </div>
          <div class="kpi">
            <div class="k">Audit</div>
            <div class="v" id="kAudit">โ</div>
          </div>
        </div>

        <div class="sep"></div>

        <div class="muted small">
          ุขุฎุฑ ุฏูุฑ:
          <b id="lastRole">โ</b>
        </div>
      </div>
    </section>

    <!-- Role Cards -->
    <section class="grid4">
      <article class="roleCard" data-role="student">
        <div class="roleTop">
          <div class="roleIcon">๐</div>
          <div>
            <h2>ุจูุงุจุฉ ุงูุทุงูุจ</h2>
            <p class="muted">ุดููู + ูุญุงูุงุฉ ุญุณุงุณุงุช + ูุฑุฒ AI + ุทูุจ ุฒูุงุฑุฉ ุงูุชุฑุงุถูุฉ</p>
          </div>
        </div>
        <ul class="roleList">
          <li>ูููุฏ ูุฑุงุกุงุช ูุงูุนู</li>
          <li>Risk / Priority / Recommendation</li>
          <li>ุฅุฑุณุงู ุงูุญุงูุฉ ููุทุจูุจ</li>
        </ul>
        <button class="btn" onclick="SCBUS.seedDemo()">
๐ ุชูุนูู ุจูุงูุงุช ุชุฌุฑูุจูุฉ
</button>
        <button class="btn full">ุฏุฎูู ุงูุทุงูุจ</button>
      </article>

      <article class="roleCard" data-role="doctor">
        <div class="roleTop">
          <div class="roleIcon">๐จโโ๏ธ</div>
          <div>
            <h2>ุจูุงุจุฉ ุงูุทุจูุจ</h2>
            <p class="muted">ูุฑุงุกุงุช + Copilot + ูุฑุงุฑ ุชููุงุฆู + ุฒูุงุฑุฉ + ุชูุฑูุฑ</p>
          </div>
        </div>
        <ul class="roleList">
          <li>ูุฑุงุกุฉ ุซุงููุฉ (ุชุฃููุฏ)</li>
          <li>DX + PLAN + ูุฑุงุฑุงุช</li>
          <li>ุชูุฑูุฑ ููุทุจุงุนุฉ</li>
        </ul>
        <button class="btn full">ุฏุฎูู ุงูุทุจูุจ</button>
      </article>

      <article class="roleCard" data-role="admin">
        <div class="roleTop">
          <div class="roleIcon">๐ซ</div>
          <div>
            <h2>ุจูุงุจุฉ ุงูุฅุฏุงุฑุฉ</h2>
            <p class="muted">ููุญุฉ ูุคุดุฑุงุช + Heatmap + ุณูุฏุงุช + ุณุฌู ุฅุฌุฑุงุกุงุช</p>
          </div>
        </div>
        <ul class="roleList">
          <li>ุญุงูุงุช ุงูููู / ุชูุฒูุน ุงูุดุฏุฉ</li>
          <li>ุณูุฏุงุช ุงูููุงููุฉ</li>
          <li>Audit Log</li>
        </ul>
        <button class="btn full">ุฏุฎูู ุงูุฅุฏุงุฑุฉ</button>
      </article>

      <article class="roleCard" data-role="parent">
        <div class="roleTop">
          <div class="roleIcon">๐จโ๐ฉโ๐ง</div>
          <div>
            <h2>ุจูุงุจุฉ ููู ุงูุฃูุฑ</h2>
            <p class="muted">ููุฎุต ูุจุณุท + ุชูุฑูุฑ ุฑุณูู + ููุงููุฉ/ุฑูุถ</p>
          </div>
        </div>
        <ul class="roleList">
          <li>ููุฎุต ููููู</li>
          <li>ุชูุฑูุฑ ุฑุณูู ููุทุจุงุนุฉ</li>
          <li>ููุงููุฉ ุชูููุฏ ุณูุฏ</li>
        </ul>
        <button class="btn full">ุฏุฎูู ููู ุงูุฃูุฑ</button>
      </article>
    </section>

    <footer class="footer">
      <div class="muted small">
        ยฉ Demo โข Smart School Clinic OS โข ูุนูู ุนูู GitHub Pages
      </div>
      <a class="link" href="report-view.html" style="opacity:.75">ูุชุญ report-view (ุงุฎุชุจุงุฑ)</a>
    </footer>
  </main>

  <script>
    (function(){
      const $ = (s)=>document.querySelector(s);

      function updateKPIs(){
        try{
          const bus = window.SCBUS?.load?.() || {requests:[], cases:[], slips:[], audit:[]};
          $("#kRequests").textContent = (bus.requests||[]).length;
          $("#kCases").textContent    = (bus.cases||[]).length;
          $("#kSlips").textContent    = (bus.slips||[]).length;
          $("#kAudit").textContent    = (bus.audit||[]).length;
          $("#lastRole").textContent  = localStorage.getItem("SC_LAST_ROLE") || "โ";
        }catch(e){
          $("#kRequests").textContent = "โ";
          $("#kCases").textContent    = "โ";
          $("#kSlips").textContent    = "โ";
          $("#kAudit").textContent    = "โ";
        }
      }

      function goRole(role){
        if(!role) return;
        window.SCAUTH?.setRole(role);
        const map = {
          student: "student.html",
          doctor:  "doctor.html",
          admin:   "admin.html",
          parent:  "parent.html"
        };
        const href = map[role] || "index.html";
        location.href = href;
      }

      // Role card click
      document.querySelectorAll(".roleCard").forEach(card=>{
        card.addEventListener("click", (e)=>{
          const role = card.getAttribute("data-role");
          goRole(role);
        });
      });

      // Seed demo data (creates one full flow minimal)
      $("#btnSeed").addEventListener("click", ()=>{
        try{
          window.SCBUS?.seedDemo?.();
          alert("ุชู ุชุฌููุฒ ุจูุงูุงุช ุงูุนุฑุถ โ");
          updateKPIs();
        }catch(e){
          alert("ููุงุญุธุฉ: seedDemo ุณูุนูู ุจุนุฏ ููู bus.js ุงูููุงุฆู.");
        }
      });

      $("#btnGoLast").addEventListener("click", ()=>{
        const last = localStorage.getItem("SC_LAST_ROLE");
        if(!last) return alert("ูุง ููุฌุฏ ุขุฎุฑ ุฏูุฑ ูุญููุธ.");
        goRole(last);
      });

      $("#btnReset").addEventListener("click", ()=>{
        const ok = confirm("ุชุฃููุฏ ุชุตููุฑ ุจูุงูุงุช ุงูุฏูููุ");
        if(!ok) return;
        try{
          window.SCBUS?.reset?.();
          alert("ุชู ุงูุชุตููุฑ โ");
          updateKPIs();
        }catch(e){
          localStorage.clear();
          alert("ุชู ุงูุชุตููุฑ โ");
          updateKPIs();
        }
      });

      updateKPIs();
      setInterval(updateKPIs, 1500);
    })();
  </script>
</body>
</html>
