<!doctype html>
<html lang="ar" dir="rtl" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Clinic OS โ Virtual Visit</title>
  <link rel="stylesheet" href="ar.css" />
</head>
<body>

<header class="topbar">
  <div class="brand">
    <div class="logo">VV</div>
    <div>
      <b id="title">ุฒูุงุฑุฉ ุงูุชุฑุงุถูุฉ</b>
      <small id="sub">WebRTC (Local Signaling)</small>
    </div>
  </div>
  <div class="actions">
    <a class="btn ghost" id="backLink" href="index.html">๐ ุฑุฌูุน</a>
    <button class="btn ghost" id="btnClear">๐งน ุชุตููุฑ ุงูุบุฑูุฉ</button>
    <button class="btn" id="btnJoin">๐ด ุฏุฎูู ุงูุฒูุงุฑุฉ</button>
  </div>
</header>

<div class="wrap">
  <div class="panel">
    <div class="h">
      <h2>ุงูุบุฑูุฉ</h2>
      <div class="muted" id="st">Idle</div>
    </div>

    <div class="row">
      <span class="badge">Role: <b id="roleTxt">โ</b></span>
      <span class="badge">Room ID: <b id="roomTxt">โ</b></span>
      <a class="btn ghost" id="openOther" href="#" target="_blank">ูุชุญ ุงูุทุฑู ุงูุขุฎุฑ (ุชุจููุจ)</a>
    </div>

    <div class="sep"></div>

    <div class="grid" style="grid-template-columns:1fr 1fr;">
      <div class="panel">
        <div class="h"><h2>ุฃูุช</h2><div class="muted">Local</div></div>
        <video id="vLocal" autoplay playsinline muted style="width:100%; border-radius:18px; border:1px solid var(--stroke);"></video>
      </div>
      <div class="panel">
        <div class="h"><h2>ุงูุทุฑู ุงูุขุฎุฑ</h2><div class="muted">Remote</div></div>
        <video id="vRemote" autoplay playsinline style="width:100%; border-radius:18px; border:1px solid var(--stroke);"></video>
      </div>
    </div>

    <div class="sep"></div>
    <div class="small">
      โ ูุฐุง ุงูุงุชุตุงู ูุนูู ูุฌุงููุง ุจุฏูู ุณูุฑูุฑ ุจุดุฑุท: ููุณ ุงูุฌูุงุฒ/ุงููุชุตูุญ (ุชุจููุจูู).<br>
      ุฅุฐุง ุชุจุบุงู ุจูู ุฌูุงุฒูู (ุทุงูุจ ุจุฌูุงู + ุทุจูุจ ุจุฌูุงุฒ ุขุฎุฑ) ุฃุนุทูู Signaling ูุฌุงูู ุจุณูุท.
    </div>
  </div>
</div>

<script src="webrtc-local.js"></script>
<script>
(function(){
  const $ = (s)=>document.querySelector(s);
  const qs = new URLSearchParams(location.search);

  const role = (qs.get("role") || "student").toLowerCase(); // student | doctor
  const room = qs.get("room") || ("R" + Math.random().toString(36).slice(2,8).toUpperCase());

  $("#roleTxt").textContent = role;
  $("#roomTxt").textContent = room;

  // titles + back links
  if(role === "doctor"){
    $("#title").textContent = "ุฒูุงุฑุฉ ุงูุชุฑุงุถูุฉ โ ุงูุทุจูุจ";
    $("#backLink").href = "doctor.html";
  } else {
    $("#title").textContent = "ุฒูุงุฑุฉ ุงูุชุฑุงุถูุฉ โ ุงูุทุงูุจ";
    $("#backLink").href = "student.html";
  }

  // Open other side (for local demo)
  const otherRole = role === "doctor" ? "student" : "doctor";
  $("#openOther").href = `visit.html?role=${encodeURIComponent(otherRole)}&room=${encodeURIComponent(room)}`;
  $("#openOther").textContent = `ูุชุญ ${otherRole === "doctor" ? "ุงูุทุจูุจ" : "ุงูุทุงูุจ"} (ุชุจููุจ)`;

  $("#btnClear").addEventListener("click", ()=>{
    window.SCWEBRTC.clearRoom(room);
    $("#st").textContent = "Room cleared";
  });

  $("#btnJoin").addEventListener("click", async ()=>{
    $("#st").textContent = "Startingโฆ";
    try{
      if(role === "doctor"){
        await window.SCWEBRTC.initDoctor(room, {
          localVideo: $("#vLocal"),
          remoteVideo: $("#vRemote"),
          status: $("#st")
        });
      } else {
        await window.SCWEBRTC.initKiosk(room, { // kiosk side == caller side
          localVideo: $("#vLocal"),
          remoteVideo: $("#vRemote"),
          status: $("#st")
        });
      }
    }catch(e){
      console.error(e);
      alert("ูุดู ุชุดุบูู ุงูุฒูุงุฑุฉ. ุชุฃูุฏ ูู ุงูุณูุงุญ ุจุงููุงููุฑุง/ุงููุงูู.");
    }
  });
  // Auto-join if requested
if(qs.get("autojoin") === "1"){
  setTimeout(()=> $("#btnJoin").click(), 450);
}
})();
</script>
</body>
</html>
