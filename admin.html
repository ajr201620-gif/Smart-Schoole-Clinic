<!doctype html>
<html lang="ar" dir="rtl" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Smart Clinic OS โ Admin</title>
  <link rel="stylesheet" href="ar.css"/>
  <link rel="stylesheet" href="shell.css"/>
  <script src="bus.js"></script>
  <script src="rbac.js"></script>
</head>
<body>

<div class="sc-top">
  <div class="left">
    <span class="sc-chip">Admin</span>
    <div class="sc-title">
      <b>ููุญุฉ ุฅุฏุงุฑุฉ ุงููุฏุฑุณุฉ</b>
      <small>ูุคุดุฑุงุช ููููุฉ + ูุชุงุจุนุฉ + ุฅุญุงูุงุช</small>
    </div>
  </div>
  <div class="sc-actions">
    <span class="sc-status" id="st">๐ข Ready</span>
    <a class="sc-primary" href="report.html#school">๐งพ ุชูุฑูุฑ ุงููุฏุฑุณุฉ</a>
  </div>
</div>

<div class="sc-shell">
  <aside class="sc-side">
    <div class="sc-chip">ุงูุชูููู</div>
    <nav class="sc-nav">
      <a class="sc-nav-item" href="index.html">๐ ุงูุจูุงุจุฉ</a>
      <a class="sc-nav-item" href="#dash">๐ ููุญุฉ ุงููุคุดุฑุงุช</a>
      <a class="sc-nav-item" href="#follow">๐ก ุงููุชุงุจุนุฉ</a>
      <a class="sc-nav-item" href="report.html#school">๐งพ ุงูุชูุงุฑูุฑ</a>
    </nav>
    <div style="margin-top:14px" class="sc-chip">Quick</div>
    <div class="sc-quick">
      <button class="sc-qa" id="btnRefresh">๐ ุชุญุฏูุซ</button>
    </div>
  </aside>

  <main class="sc-main">
    <div style="padding:16px">
      <div class="panel" id="dash">
        <div class="h"><h2>ูุคุดุฑุงุช ุงููุฏุฑุณุฉ</h2><div class="muted">ุชุฌููุนู ุจุฏูู ุชูุงุตูู ุญุณุงุณุฉ</div></div>

        <div class="kpis">
          <div class="kpi"><b>ุนุฏุฏ ุงูุทูุงุจ ุงููู ูุดููุง</b><span id="mChecked">โ</span></div>
          <div class="kpi"><b>ุญุงูุงุช ูุชุนุจุฉ (MED+)</b><span id="mSick">โ</span></div>
          <div class="kpi"><b>ุฑุงุญุฉ/ูุชุงุจุนุฉ</b><span id="mRest">โ</span></div>
          <div class="kpi"><b>ุฅุญุงูุงุช</b><span id="mRef">โ</span></div>
          <div class="kpi"><b>ุชุญุชุงุฌ ูุชุงุจุนุฉ</b><span id="mFollow">โ</span></div>
          <div class="kpi"><b>ููุงููุฉ ููู ุฃูุฑ ูุนูููุฉ</b><span id="mConsent">โ</span></div>
        </div>

        <div class="sep"></div>

        <div class="panel" id="follow" style="padding:12px; border-radius:14px;">
          <b>ูุงุฆูุฉ ูุชุงุจุนุฉ (ุขุฎุฑ 6 ุญุงูุงุช)</b>
          <div class="muted small">ูุนุฑุถ ุงูุญุงูุงุช ุนุงููุฉ/ูุนููุฉ/ุฅุญุงูุฉ</div>
          <div id="list" style="margin-top:10px"></div>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
localStorage.setItem("SC_ROLE","admin");
const $ = (s)=>document.querySelector(s);

function refresh(){
  const bus = window.SCBUS?.load?.() || {cases:[], requests:[]};
  const cases = bus.cases || [];
  const requests = bus.requests || [];

  const checked = requests.length; // ุงุนุชุจุฑ ูู Request = ูุดู
  const sick = cases.filter(c => ["MED","HIGH","CRIT"].includes(c.priority)).length;

  const ref = cases.filter(c => c.status==="REFERRED").length;
  const consent = cases.filter(c => c.status==="CONSENT_REQUIRED").length;

  const rest = cases.filter(c => (c.plan||"").includes("ุฑุงุญุฉ") || c.status==="APPROVED").length;
  const follow = cases.filter(c => ["HIGH","CRIT"].includes(c.priority) || c.status==="CONSENT_REQUIRED").length;

  $("#mChecked").textContent = checked;
  $("#mSick").textContent = sick;
  $("#mRest").textContent = rest;
  $("#mRef").textContent = ref;
  $("#mFollow").textContent = follow;
  $("#mConsent").textContent = consent;

  const top = cases.slice(0,6);
  $("#list").innerHTML = top.map(c=>{
    const tag = c.status || "OPEN";
    return `<div class="sc-nav-item" style="justify-content:space-between">
      <span>Case ${c.id} โข ${c.priority||"โ"}</span>
      <span class="sc-chip">${tag}</span>
    </div>`;
  }).join("") || `<div class="muted">ูุง ุชูุฌุฏ ุจูุงูุงุช ุจุนุฏ</div>`;
}

$("#btnRefresh").addEventListener("click", refresh);
refresh();
</script>
</body>
</html>
