<!doctype html>
<html lang="ar" dir="rtl" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Clinic OS โ ุฅุฏุงุฑุฉ ุงููุฏุฑุณุฉ</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <!-- Topbar -->
  <header class="topbar">
    <div class="brand">
      <div class="logo">SC</div>
      <div>
        <div class="brand-title">Smart Clinic OS</div>
        <div class="brand-sub">School Admin Console โ ููุญุฉ ุฅุฏุงุฑุฉ ุงููุฏุฑุณุฉ</div>
      </div>
    </div>

    <div class="top-actions">
  <a class="btn ghost" href="index.html">๐ ุชุจุฏูู ุงูุฏูุฑ</a>
  <button class="btn ghost" id="btnTheme">๐</button>
</div>
  </header>

  <div class="layout">

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="nav-title">ุงููุงุฆูุฉ</div>
      <nav class="nav" id="adminNav">
        <button class="nav-item active" data-view="dashboard"><span class="ico">๐</span><span>Dashboard</span></button>
        <button class="nav-item" data-view="reports"><span class="ico">๐งพ</span><span>ุชูุงุฑูุฑ ุฅุฏุงุฑูุฉ</span></button>
        <button class="nav-item" data-view="users"><span class="ico">๐ฅ</span><span>Users & Roles</span></button>
      </nav>

      <div class="sidebar-foot">
        <div class="pill">
          <span class="dot" id="dotLive"></span>
          <div>
            <div style="font-weight:1000;">System</div>
            <div class="muted small" id="sysStatus">System: Ready</div>
          </div>
        </div>

        <button class="btn ghost" id="btnShowLog">ุนุฑุถ ุณุฌู ุงููุธุงู</button>

        <div class="divider"></div>
        <div class="muted small">ููุงุญุธุฉ: ูุฐู ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุจุฏูู ุชูุงุตูู ุณุฑูุฑูุฉ ุญุณุงุณุฉ.</div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">

      <!-- Hero -->
      <section class="hero">
        <div class="hero-left">
          <div class="kicker">๐ซ School Admin</div>
          <h1>ููุญุฉ ุฅุฏุงุฑุฉ ุงููุฏุฑุณุฉ</h1>
          <p class="hero-desc">
            ูุคุดุฑุงุช ูุฌููุนุฉุ ุฅุฌุฑุงุกุงุช ุฅุฏุงุฑูุฉุ ุญูููุฉ ูุตูุงุญูุงุชุ ูุณุฌู ุชุฏููู (Audit).
          </p>

          <div class="hero-cta">
            <button class="btn" id="btnOpenUsers">ูุชุญ Users & Roles</button>
            <button class="btn ghost" id="btnOpenAudit">ูุชุญ Audit Log</button>
          </div>

          <div class="hero-badges">
            <span class="badge">RBAC: Enabled</span>
            <span class="badge ghost">No Sensitive Clinical Details</span>
            <span class="badge">GitHub Pages Ready</span>
          </div>
        </div>

        <div class="hero-right">
          <div class="scorecard">
            <div class="scorecard-head">
              <div>
                <div class="score-title">ูุคุดุฑ ุงูุณูุงูุฉ ุงููุฏุฑุณูุฉ</div>
                <div class="score-sub">ูููุฉ ุชุฌุฑูุจูุฉ ููุนุฑุถ</div>
              </div>
              <div class="ring">
                <div class="ring-inner">
                  <div class="ring-num" id="safetyScore">92</div>
                  <div class="ring-lbl">/100</div>
                </div>
              </div>
            </div>

            <div class="scorecard-grid">
              <div class="mini">
                <div class="mini-k">ุชูุจููุงุช ุงูููู</div>
                <div class="mini-v danger" id="kpiAlerts">2</div>
              </div>
              <div class="mini">
                <div class="mini-k">ุญุงูุงุช ูุชุงุจุนุฉ</div>
                <div class="mini-v warn" id="kpiFollow">5</div>
              </div>
              <div class="mini">
                <div class="mini-k">ุบูุงุจ ุตุญู</div>
                <div class="mini-v" id="kpiAbsence">-12%</div>
              </div>
              <div class="mini">
                <div class="mini-k">ุฌุงูุฒูุฉ ุชูุงุฑูุฑ</div>
                <div class="mini-v" id="kpiReports">+40%</div>
              </div>
            </div>

            <div class="scorecard-foot muted small">* ุฌููุน ุงูุฃุฑูุงู ุชุฌุฑูุจูุฉ (Demo).</div>
          </div>
        </div>
      </section>

      <!-- Views -->
      <section class="views">

        <!-- Dashboard -->
        <section class="view show" id="view-dashboard">
          <div class="section-head">
            <div>
              <h2>Dashboard</h2>
              <div class="muted">ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุถุน ุงูุตุญู ุฏุงุฎู ุงููุฏุฑุณุฉ (ูุฌููุน)</div>
            </div>
            <div class="section-actions">
              <button class="btn ghost" id="btnRefresh">ุชุญุฏูุซ ุงูุฃุฑูุงู</button>
              <button class="btn" id="btnSimAdminEvent">ูุญุงูุงุฉ ุฅุฌุฑุงุก ุฅุฏุงุฑู</button>
            </div>
          </div>

          <div class="grid-4">
            <div class="card kpi">
              <div class="kpi-top">
                <div class="kpi-ico">๐</div>
                <div>
                  <div class="kpi-label">ูุงุฆูุฉ ุงูุฅุฌุฑุงุกุงุช</div>
                  <div class="kpi-value" id="kpiQueue">3</div>
                </div>
              </div>
              <div class="kpi-note">ุนุฏุฏ ุงูููุงู ุงูุฅุฏุงุฑูุฉ ุงูููุชูุญุฉ ุงูููู.</div>
              <div class="kpi-bar"><span style="width:58%"></span></div>
            </div>

            <div class="card kpi">
              <div class="kpi-top">
                <div class="kpi-ico">๐งโ๐คโ๐ง</div>
                <div>
                  <div class="kpi-label">ุชูุงุนู ุฃูููุงุก ุงูุฃููุฑ</div>
                  <div class="kpi-value" id="kpiParentAck">76%</div>
                </div>
              </div>
              <div class="kpi-note">ูุณุจุฉ ุชุฃููุฏ ุงุณุชูุงู ุงูุชูุจููุงุช (Demo).</div>
              <div class="kpi-bar"><span style="width:76%"></span></div>
            </div>

            <div class="card kpi">
              <div class="kpi-top">
                <div class="kpi-ico">๐งผ</div>
                <div>
                  <div class="kpi-label">ุฌุงูุฒูุฉ ุงูุชูุนูุฉ</div>
                  <div class="kpi-value" id="kpiAwareness">ููุชุงุฒุฉ</div>
                </div>
              </div>
              <div class="kpi-note">ุฎุทุท ุชูุนููุฉ ุตููุฉ ุนูุฏ ููุท ุฃุนุฑุงุถ.</div>
              <div class="kpi-bar"><span style="width:86%"></span></div>
            </div>

            <div class="card kpi">
              <div class="kpi-top">
                <div class="kpi-ico">๐ก๏ธ</div>
                <div>
                  <div class="kpi-label">ุงูุชุฒุงู ุงูุญูููุฉ</div>
                  <div class="kpi-value">RBAC</div>
                </div>
              </div>
              <div class="kpi-note">ุงูุตูุงุญูุงุช ููุนููุฉ + ุณุฌู ุชุฏููู (Audit).</div>
              <div class="kpi-bar"><span style="width:92%"></span></div>
            </div>
          </div>

          <div class="grid-2">
            <div class="card">
              <div class="card-head">
                <h3>ุฅุฌุฑุงุกุงุช ูุทููุจุฉ</h3>
                <div class="muted small">Work Queue</div>
              </div>

              <div class="queue" id="adminQueue">
                <div class="qitem">
                  <b>ุงุณุชุฏุนุงุก ููู ุฃูุฑ</b>
                  <span class="muted">ุญุงูุฉ ูุชุงุจุนุฉ โ (Demo)</span>
                  <span class="tag">OPEN</span>
                </div>
                <div class="qitem">
                  <b>ุชูุณูู ุฅุญุงูุฉ/ููู</b>
                  <span class="muted">ุชูุจูู ุนุงูู โ (Demo)</span>
                  <span class="tag">OPEN</span>
                </div>
                <div class="qitem">
                  <b>ุชูุนูุฉ ุตููุฉ</b>
                  <span class="muted">ููุท ุฃุนุฑุงุถ โ (Demo)</span>
                  <span class="tag">PLANNED</span>
                </div>
              </div>

              <div class="card-actions">
                <button class="btn ghost" id="btnCloseOne">ุฅุบูุงู ูููุฉ (Demo)</button>
                <button class="btn" id="btnEscalate">ุชุตุนูุฏ ููุฅุดุฑุงู (Demo)</button>
              </div>
            </div>

            <div class="card">
              <div class="card-head">
                <h3>ุณุฌู ุงููุธุงู (ูุฎุชุตุฑ)</h3>
                <div class="muted small">System log preview</div>
              </div>

              <div class="log" id="sysLog">
                <div class="logline"><span class="muted">--:--:--</span><span>ุจุงูุชุธุงุฑ ุงูุฃุญุฏุงุซโฆ</span></div>
              </div>

              <div class="card-actions">
                <button class="btn ghost" id="btnSyncSensors">ูุญุงูุงุฉ Sync ุญุณุงุณุงุช</button>
                <button class="btn" id="btnCreateAdminAlert">ุฅูุดุงุก ุชูุจูู ุฅุฏุงุฑู</button>
              </div>
            </div>
          </div>
        </section>

        <!-- Reports -->
        <section class="view" id="view-reports">
          <div class="section-head">
            <div>
              <h2>ุชูุงุฑูุฑ ุฅุฏุงุฑูุฉ</h2>
              <div class="muted">ููุฎุตุงุช ูุฌููุนุฉ ุจุฏูู ุชูุงุตูู ุญุณุงุณุฉ</div>
            </div>
            <div class="section-actions">
              <button class="btn" id="btnExportDaily">ุชุตุฏูุฑ ููุฎุต ุงูููู</button>
              <button class="btn ghost" id="btnExportWeekly">ุชุตุฏูุฑ ููุฎุต ุฃุณุจูุนู</button>
            </div>
          </div>

          <div class="card report" id="reportBox">
            <div class="report-title">ููุฎุต ุฅุฏุงุฑู โ Demo</div>
            <div class="report-meta">ุงููุทุงู: ูุฏุฑุณุฉ A โ ุงูุชุงุฑูุฎ: <span id="repDate"></span></div>
            <div class="report-body rb">
              <div>โข ุงูุญุงูุงุช: <b>ูุฌููุนุฉ</b> (ุจุฏูู ุชุดุฎูุต ุณุฑูุฑู)</div>
              <div>โข ุงูุชูุจููุงุช: <b>ุญุณุจ ุงููุณุชูู</b> (LOW/MED/HIGH)</div>
              <div>โข ุงูุฅุฌุฑุงุกุงุช: <b>ูุชุงุจุนุฉ/ุงุณุชุฏุนุงุก ููู ุฃูุฑ/ุชูุนูุฉ</b></div>
              <div>โข ุงูุญูููุฉ: <b>RBAC + Audit</b></div>
            </div>
            <div class="report-foot muted small">* ูุฐุง ุชูุฑูุฑ ุชุฌุฑูุจู ููุนุฑุถ ูุงูุชุญููู.</div>
          </div>

          <div class="divider"></div>

          <div class="grid-2">
            <div class="card copy">
              <div class="card-head">
                <h3>ุชูุจูู ุฅุฏุงุฑู ููุชุฑุญ</h3>
                <div class="muted small">Template</div>
              </div>
              <p>
                ุจูุงุกู ุนูู ููุท ุงูุฃุนุฑุงุถ ุงููุณุฌู ูุฐุง ุงููููุ ููุตู ุจุชูุนูู ุฅุฌุฑุงุก ุชูุนูู ุตููู
                ูุชุนุฒูุฒ ุงูุชุญูู ุงูููุงุฆูุ ูุน ุฅุดุนุงุฑ ุฃูููุงุก ุงูุฃููุฑ ุจุงููุชุงุจุนุฉ ุนูุฏ ุงูุญุงุฌุฉ.
              </p>
              <div class="card-actions">
                <button class="btn" id="btnCreateAdminAlert2">ุงุนุชูุงุฏ ุงูุชูุจูู (Demo)</button>
              </div>
            </div>

            <div class="card">
              <div class="card-head">
                <h3>ูุคุดุฑุงุช ุงูุงูุชุซุงู</h3>
                <div class="muted small">Governance</div>
              </div>
              <ul class="bullets">
                <li>ุชูููุฏ ุงููุตูู ุญุณุจ ุงูุฏูุฑ (Role-Based Access)</li>
                <li>ุนุฏู ุนุฑุถ ุชูุงุตูู ุณุฑูุฑูุฉ ููุฅุฏุงุฑุฉ (Masked by design)</li>
                <li>ุณุฌู ุชุฏููู ููุฃุญุฏุงุซ (Audit Log)</li>
                <li>ูุงุจููุฉ ุงูุชูุณุน ูุชูุงููุงุช ุฑุณููุฉ ูุงุญููุง</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Users -->
        <section class="view" id="view-users">
          <div class="section-head">
            <div>
              <h2>Users & Roles</h2>
              <div class="muted">ุฅุธูุงุฑ ุงูุตูุงุญูุงุช ูุณุฌู ุงูุชุฏููู (Demo)</div>
            </div>
            <div class="section-actions">
              <button class="btn" id="btnAddUser">ุฅุถุงูุฉ ูุณุชุฎุฏู (Demo)</button>
              <button class="btn ghost" id="btnExportUsers">ุชุตุฏูุฑ Users</button>
            </div>
          </div>

          <div class="grid-2">
            <div class="card">
              <div class="card-head">
                <h3>Users</h3>
                <div class="muted small">School scope</div>
              </div>
              <div class="table" id="usersTable"></div>
            </div>

            <div class="card">
              <div class="card-head">
                <h3>Audit Log</h3>
                <div class="muted small">ุขุฎุฑ 40 ุญุฏุซ</div>
              </div>
              <div class="table" id="auditTable"></div>
              <div class="card-actions">
                <button class="btn ghost" id="btnClearAudit">ูุณุญ ุงูุณุฌู</button>
                <button class="btn" id="btnExportAudit">ุชุตุฏูุฑ Audit</button>
              </div>
            </div>
          </div>
        </section>

      </section>
    </main>
  </div>

  <!-- Scripts -->
  <script src="bus.js"></script>
<script src="engine.js"></script>
<script src="rbac.js"></script>
<script src="auth-demo.js"></script>
<script src="audit-users.js"></script>

  <script>
    // --- Admin Page Controller (small + safe) ---
    (function(){
      const $ = (s,r=document)=>r.querySelector(s);
      const $$ = (s,r=document)=>Array.from(r.querySelectorAll(s));
      const rand = (a,b)=>Math.floor(Math.random()*(b-a+1))+a;

      // Force role to school for this page (Admin)
      try{
        localStorage.setItem("sc_role", "school");
        window.SCRBAC?.applyRBAC?.();
      }catch(_){}

      // Date
      const d = new Date();
      const repDate = $("#repDate");
      if(repDate) repDate.textContent = d.toLocaleDateString("ar-SA");

      // Theme toggle
      $("#btnTheme")?.addEventListener("click", ()=>{
        const html = document.documentElement;
        const next = html.dataset.theme === "light" ? "dark" : "light";
        html.dataset.theme = next;
        try{ window.SCAUDIT?.audit?.("THEME_TOGGLE", { to: next }); }catch(_){}
      });

      // Simple nav switching
      function openView(view){
        $$(".nav-item").forEach(b=>b.classList.remove("active"));
        $(`.nav-item[data-view="${view}"]`)?.classList.add("active");
        $$(".view").forEach(v=>v.classList.remove("show"));
        $(`#view-${view}`)?.classList.add("show");
        try{ window.SCAUDIT?.audit?.("NAV_OPEN", { view }); }catch(_){}
      }
      $$("#adminNav .nav-item").forEach(btn=>{
        btn.addEventListener("click", ()=> openView(btn.dataset.view));
      });

      $("#btnOpenUsers")?.addEventListener("click", ()=> openView("users"));
      $("#btnOpenAudit")?.addEventListener("click", ()=> openView("users")); // audit ุฏุงุฎู users

      // Simulate admin events
      $("#btnRefresh")?.addEventListener("click", ()=>{
        $("#kpiAlerts").textContent = String(rand(0,3));
        $("#kpiFollow").textContent = String(rand(2,8));
        $("#safetyScore").textContent = String(rand(88,97));
        $("#kpiParentAck").textContent = String(rand(60,92)) + "%";
        $("#dotLive")?.classList.add("pulse");
        setTimeout(()=>$("#dotLive")?.classList.remove("pulse"), 900);
        try{ window.SCAUDIT?.audit?.("DASH_REFRESH", {}); }catch(_){}
      });

      $("#btnSimAdminEvent")?.addEventListener("click", ()=>{
        try{ window.SCAUDIT?.audit?.("ADMIN_ACTION_SIMULATED", { type:"queue_update" }); }catch(_){}
        alert("ุชู ุชุณุฌูู ุฅุฌุฑุงุก ุฅุฏุงุฑู (Demo) ูู Audit Log โ");
      });

      $("#btnSyncSensors")?.addEventListener("click", ()=>{
        try{ window.ClinicEngine?.syncSensors?.(); }catch(_){}
        try{ window.SCAUDIT?.audit?.("SENSORS_SYNC_CLICK", { from:"admin" }); }catch(_){}
      });

      $("#btnCreateAdminAlert")?.addEventListener("click", ()=>{
        try{ window.SCAUDIT?.audit?.("ADMIN_ALERT_CREATED", { level:"MED" }); }catch(_){}
        alert("ุชู ุฅูุดุงุก ุชูุจูู ุฅุฏุงุฑู (Demo) โ");
      });

      $("#btnCreateAdminAlert2")?.addEventListener("click", ()=>{
        try{ window.SCAUDIT?.audit?.("ADMIN_ALERT_APPROVED", {}); }catch(_){}
        alert("ุชู ุงุนุชูุงุฏ ุงูุชูุจูู (Demo) โ");
      });

      $("#btnCloseOne")?.addEventListener("click", ()=>{
        const q = $("#adminQueue");
        const first = q?.querySelector(".qitem");
        if(first) first.remove();
        try{ window.SCAUDIT?.audit?.("QUEUE_ITEM_CLOSED", {}); }catch(_){}
      });

      $("#btnEscalate")?.addEventListener("click", ()=>{
        try{ window.SCAUDIT?.audit?.("ESCALATION_SENT", { to:"supervision" }); }catch(_){}
        alert("ุชู ุงูุชุตุนูุฏ (Demo) โ");
      });

      // Exports (simple)
      function download(name, text){
        const blob = new Blob([text], {type:"text/plain;charset=utf-8"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; a.download = name;
        document.body.appendChild(a);
        a.click(); a.remove();
        setTimeout(()=>URL.revokeObjectURL(url), 600);
      }

      $("#btnExportDaily")?.addEventListener("click", ()=>{
        const txt = [
          "Administrative Daily Summary (Demo)",
          "----------------------------------",
          `Date: ${new Date().toLocaleDateString("ar-SA")}`,
          `Alerts: ${$("#kpiAlerts")?.textContent || "2"}`,
          `Follow-ups: ${$("#kpiFollow")?.textContent || "5"}`,
          "Note: Aggregate only (no clinical sensitive details)."
        ].join("\n");
        download("daily-summary.txt", txt);
        try{ window.SCAUDIT?.audit?.("DAILY_SUMMARY_EXPORTED", {}); }catch(_){}
      });

      $("#btnExportWeekly")?.addEventListener("click", ()=>{
        download("weekly-summary.txt", "Weekly Summary (Demo)\n- Aggregate KPIs\n- Actions\n- Governance: RBAC + Audit");
        try{ window.SCAUDIT?.audit?.("WEEKLY_SUMMARY_EXPORTED", {}); }catch(_){}
      });

      $("#btnExportAdmin")?.addEventListener("click", ()=>{
        download("admin-executive-summary.txt", "Executive Summary (Demo)\nRBAC enabled\nAudit enabled\nAggregate KPIs only");
        try{ window.SCAUDIT?.audit?.("EXEC_SUMMARY_EXPORTED", {}); }catch(_){}
      });

      // Log viewer shortcut
      $("#btnShowLog")?.addEventListener("click", ()=>{
        openView("dashboard");
        const el = $("#sysLog");
        el?.scrollIntoView({behavior:"smooth", block:"center"});
      });

    })();
  </script>
</body>
</html>
