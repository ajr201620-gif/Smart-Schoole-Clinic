<!doctype html>
<html lang="ar" dir="rtl" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Clinic OS โ Kiosk</title>
  <link rel="stylesheet" href="ar.css" />
</head>
<body>

<header class="topbar">
  <div class="brand">
    <div class="logo">KS</div>
    <div>
      <b>ุงููุดู ุงูุทุจู โ ูุญุงูุงุฉ ุญุณุงุณุงุช</b>
      <small>Vitals + Risk + ุฅุฑุณุงู ููุทุจูุจ</small>
    </div>
  </div>
  <div class="actions">
    <a class="btn ghost" href="index.html">๐ ุงูุจูุงุจุฉ</a>
    <a class="btn ghost" href="doctor.html">๐จโโ๏ธ ุงูุทุจูุจ</a>
    <a class="btn ghost" href="report.html">๐งพ ุงูุชูุงุฑูุฑ</a>
  </div>
</header>

<div class="wrap">
  <div class="grid">
    <!-- left: simulator -->
    <div class="panel">
      <div class="h">
        <h2>ูุญุงูุงุฉ ุงูุญุณุงุณุงุช</h2>
        <div class="muted">Virtual Sensors</div>
      </div>

      <div class="row">
        <span class="badge">๐ค ุงูุทุงูุจ: <b id="sName">โ</b></span>
        <span class="badge">๐ <b id="sId">โ</b></span>
        <span class="badge">๐ <b id="sClass">โ</b></span>
      </div>

      <div class="sep"></div>

      <div class="kpis">
        <div class="kpi"><b>Temp</b><span id="kTemp">โ</span></div>
        <div class="kpi"><b>HR</b><span id="kHr">โ</span></div>
        <div class="kpi"><b>SpOโ</b><span id="kSp">โ</span></div>
        <div class="kpi"><b>BP</b><span id="kBp">โ</span></div>

        <div class="kpi"><b>Risk</b><span id="kRisk">โ</span></div>
        <div class="kpi"><b>Priority</b><span id="kPri">โ</span></div>
      </div>

      <div class="sep"></div>

      <div class="row">
        <button class="btn" id="btnNewStudent">๐ค ุทุงูุจ ุฌุฏูุฏ</button>
        <button class="btn ghost" id="btnScanNormal">โ ููุงุณ ุทุจูุนู</button>
        <button class="btn ghost" id="btnScanMild">๐ก ููุงุณ ูุชูุณุท</button>
        <button class="btn ghost" id="btnScanSick">๐ ููุงุณ ุนุงูู</button>
        <button class="btn ghost" id="btnScanCrit">๐ด ููุงุณ ุญุฑุฌ</button>
      </div>

      <div class="row">
        <button class="btn" id="btnAutoPick">๐ฒ ุชูููุฏ ุฐูู (ุญุณุจ ุงูุงุญุชูุงู)</button>
        <button class="btn" id="btnSubmit">๐จ ุฅุฑุณุงู ููุทุจูุจ</button>
      </div>

      <div class="sep"></div>

      <div class="small" id="hint">
        ุงุถุบุท โุทุงูุจ ุฌุฏูุฏโ ุซู ุงุฎุชุฑ ููุน ุงูููุงุณ. ุนูุฏ โุฅุฑุณุงู ููุทุจูุจโ ุณูุชู ุฅูุดุงุก Request + Case ุนุจุฑ BUS.
      </div>
    </div>

    <!-- right: status -->
    <div class="panel">
      <div class="h">
        <h2>ุงูุญุงูุฉ</h2>
        <div class="muted">System</div>
      </div>

      <div class="row">
        <span class="badge">๐ <b id="tNow">โ</b></span>
        <span class="badge">BUS: <b id="busOk">โ</b></span>
      </div>

      <div class="sep"></div>

      <div class="small">
        โ ุฅุฐุง ุงูุญุงูุฉ <b>HIGH/CRIT</b> ุงููุธุงู ููุจู ููู ุงูุฃูุฑ + ุงูุฅุฏุงุฑุฉ ุชููุงุฆููุง.<br>
        โ ุงูุทุจูุจ ููุชุญ <b>doctor.html</b> ููุดูู ุงูุญุงูุฉ ุงูุฌุฏูุฏุฉ.<br>
        โ ุงูุชูุฑูุฑ ูุธูุฑ ูู <b>report.html</b>.
      </div>

      <div class="sep"></div>

      <div class="row">
        <a class="btn ghost" href="demo-hub.html">๐ฌ (ุงุฎุชูุงุฑู) Demo Hub</a>
        <a class="btn ghost" href="ar-doctor.html">๐ท AR Doctor</a>
        <a class="btn ghost" href="ar-student.html">๐ท AR Student</a>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"><b>โ</b><small>โ</small></div>

<script src="bus.js"></script>
<script src="sensor-sim.js"></script>
<script>
(function(){
  const $ = (s)=>document.querySelector(s);
  const toast = (t,b)=>window.SCARKIT?.toast ? window.SCARKIT.toast(t,b) : alert(t + "\\n" + (b||""));

  const setText = (id, v)=> { const el=$(id); if(el) el.textContent = v; };

  // time
  setInterval(()=> setText("#tNow", new Date().toLocaleTimeString("ar-SA")), 500);

  // student + vitals state
  let student = window.SCSIM.genStudent();
  let vitals = window.SCSIM.genVitals("normal");

  function renderStudent(){
    setText("#sName", student.studentName);
    setText("#sId", student.studentId);
    setText("#sClass", student.classRoom);
  }

  function renderVitals(){
    setText("#kTemp", vitals.temp + "ยฐC");
    setText("#kHr", vitals.hr + " bpm");
    setText("#kSp", vitals.spo2 + "%");
    setText("#kBp", vitals.bp);
    setText("#kRisk", vitals.risk + "/100");
    setText("#kPri", vitals.priority);
  }

  function busStatus(){
    setText("#busOk", window.SCBUS ? "โ ุฌุงูุฒ" : "โ ุบูุฑ ููุฌูุฏ");
  }

  function scan(profile){
    vitals = window.SCSIM.genVitals(profile);
    renderVitals();
    const msg =
      vitals.priority==="CRIT" ? "ุญุงูุฉ ุญุฑุฌุฉ โ ุฑุงุญ ุชูุฑุณู ููุฑูุง" :
      vitals.priority==="HIGH" ? "ุญุงูุฉ ุนุงููุฉ โ ุชูุงุตู ุทุจูุจ" :
      vitals.priority==="MED" ? "ุญุงูุฉ ูุชูุณุทุฉ โ ูุฑุงุฌุนุฉ ุนูุงุฏุฉ" :
      "ุทุจูุนู โ ูุตุงุฆุญ ููุท";

    $("#hint").textContent = msg + " (ูุญุงูุงุฉ)";
    toast("ุชูุช ุงููุฑุงุกุฉ", `Priority=${vitals.priority} โข Risk=${vitals.risk}`);
  }

  $("#btnNewStudent").addEventListener("click", ()=>{
    student = window.SCSIM.genStudent();
    renderStudent();
    toast("ุทุงูุจ ุฌุฏูุฏ", student.studentName);
  });

  $("#btnScanNormal").addEventListener("click", ()=>scan("normal"));
  $("#btnScanMild").addEventListener("click", ()=>scan("mild"));
  $("#btnScanSick").addEventListener("click", ()=>scan("sick"));
  $("#btnScanCrit").addEventListener("click", ()=>scan("critical"));

  $("#btnAutoPick").addEventListener("click", ()=>{
    // weighted random
    const p = Math.random();
    const profile = p < 0.62 ? "normal" : p < 0.82 ? "mild" : p < 0.95 ? "sick" : "critical";
    scan(profile);
  });

  $("#btnSubmit").addEventListener("click", ()=>{
    if(!window.SCBUS){
      toast("BUS ุบูุฑ ุฌุงูุฒ", "ุชุฃูุฏ ูู ูุฌูุฏ bus.js");
      return;
    }
    const res = window.SCSIM.createBusFlow(student, vitals, "ููุงุณุงุช ูุดู (ูุญุงูุงุฉ)");
    toast("ุชู ุงูุฅุฑุณุงู ููุทุจูุจ โ", `Case: ${res.case.id}`);
    if(vitals.priority === "HIGH" || vitals.priority === "CRIT"){
  const room = "C" + res.case.id.replace(/[^A-Z0-9]/gi,"").slice(-6);
  window.open(`call-kiosk.html?room=${encodeURIComponent(room)}`, "_blank");
}
  });

  // init
  renderStudent(); renderVitals(); busStatus();
})();
</script>
</body>
</html>
